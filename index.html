<!DOCTYPE html>
<html>

<body>

  <head>
    <title>Calculadora - Inversiones</title>
    <style>
      @font-face {
        font-family: 'Neptune';
        src: url('Neptune-Regular.ttf');
        font-weight: normal;
      }

      @font-face {
        font-family: 'Neptune';
        src: url('Neptune-Bold.ttf');
        font-weight: bold;
      }

      @font-face {
        font-family: 'PPFragment';
        src: url('PPFragment.ttf');
      }

      body {
        font-family: 'Neptune', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      label {
        color: #757575;
      }

      .container {
        display: flex;
        justify-content: center;
        width: 100%;
        gap: 100px;

        @media screen and (max-width: 768px) {
          flex-direction: column;
          gap: 50px;
        }
      }

      .form {
        display: flex;
      }

      .headTitle {
        font-family: 'PPFragment', sans-serif;
        font-size: 56px;
        font-style: normal;
        font-weight: 400;
        line-height: 61.6px;
        margin-top: 103px;
        margin-bottom: 32px;

        @media screen and (max-width: 640px) {
          font-size: 32px;
          line-height: 40px;
          margin-top: unset;
          margin-bottom: 20px;
        }
      }

      .graphicContainer {
        margin-top: 40px;

        @media screen and (max-width: 640px) {
          margin-top: 20px;
        }
      }

      .graphic {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 347px;
        border-radius: 0px 67.426px 0px 0px;
        border: 1px solid #EDEDED;
        background: #FFF;
        box-shadow: 0px 5.394px 53.94px 0px rgba(210, 210, 210, 0.25);
        margin-top: 32px;
        padding: 77px 64px;

        @media screen and (max-width: 640px) {
          margin-top: unset;
          padding: 50px 0px !important;
          border-radius: unset;
          box-shadow: unset;
          border: unset;
        }
      }

      .totalBalance {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .futureBalance {
        color: #000;
        font-family: 'Neptune', sans-serif;
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 17.6px;

        @media screen and (max-width: 460px) {
          max-width: 145px;
        }
      }

      .totalRetenciones {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 20px;
      }

      .retencionesLabel {
        color: #000;
        font-family: 'Neptune', sans-serif;
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 17.6px;
      }

      .resultado {
        color: #3B82F6;
        font-family: 'Neptune', sans-serif;
        font-size: 35px;
        font-weight: 400;
        line-height: 38.5px;

        @media screen and (max-width: 640px) {
          font-size: 29px;
        }
      }

      .retenciones {
        color: #000;
        font-family: 'Neptune', sans-serif;
        font-size: 20px;
        font-weight: 400;
        line-height: 24px;

        @media screen and (max-width: 640px) {
          font-size: 20px;
        }
      }

      .line {
        display: flex;
        flex-direction: column;
      }

      .amountTitle {
        color: #757575;
        font-family: 'Neptune', sans-serif;
        font-size: 16px;
        font-weight: 400;
        line-height: 17.6px;
        margin-bottom: 10px;
      }

      .amountContainer {
        max-width: 371px;
        font-size: 24px;
        display: flex;
        font-weight: 400;
        border-bottom-width: 1.44px;
        border-bottom-style: solid;
        border-bottom-color: #dedede;
        padding-bottom: 12px;
        justify-content: space-between;
        align-items: center;

        @media screen and (max-width: 640px) {
          max-width: unset;
        }
      }

      .mobileTitle {
        display: none;
        font-family: 'PPFragment', sans-serif !important;
        font-size: 56px !important;
        font-style: normal !important;
        font-weight: 400 !important;
        line-height: 61.6px !important;

        @media screen and (max-width: 640px) {
          display: block !important;
          font-size: 32px !important;
          line-height: 40px !important;
          margin-bottom: 16px;

        }
      }

      .amount {
        width: 130px;
        border: none;
        font-size: 24px;
        padding: 0;
      }

      .currency {
        color: #000;
        font-family: 'Neptune', sans-serif;
        font-size: 24px;
        font-weight: 400;
        line-height: 28.8px;
      }

      .amountButtonContainer {
        display: flex;
        gap: 12px;
      }

      .counterButton {
        height: 34px;
        width: 34px;
        border: 1px solid #BBBBBB;
        background-color: #fff;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 0;
      }

      .counterButton img {
        max-width: 100%;
        max-height: 100%;
      }

      .disclaimer {
        color: #CFCDCD;
        font-family: 'Neptune', sans-serif;
        font-size: 13px;
        font-weight: 400;
        line-height: 19.5px;
        margin-top: 8px;
      }

      .chooseInvestedTerm {
        color: #757575;
        font-family: 'Neptune', sans-serif;
        font-size: 16px !important;
        font-weight: 400;
        line-height: 17.6px;
        margin-top: 32px;
        margin-bottom: 12px;

        @media screen and (max-width: 640px) {
          margin-top: 20px;
          margin-bottom: 14px;
        }
      }

      input {
        outline: none;
      }

      input[type="radio"] {
        display: none;
      }

      .custom-radio {
        display: flex;
        width: 16px;
        height: 16px;
        border: 2px solid #BBB;
        border-radius: 50%;
        position: relative;
        cursor: pointer;
      }

      input[type="radio"]:checked+.custom-radio {
        background-color: #2437F5;
        border: 2px solid #2437F5;
      }

      .custom-radio::after {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: none;
      }

      input[type="radio"]:checked+.custom-radio::after {
        display: block;
      }

      .radioGroup {
        width: 100%;
        display: grid;
        column-gap: 2rem;
        row-gap: 11px;
        grid-template-columns: 1fr 1fr 300px;
        margin-bottom: 12px;
        color: #2C2C2C;

        @media screen and (max-width: 640px) {
          row-gap: 13px;
        }
      }

      .radioGroupItem {
        display: flex;
        align-items: center;
        justify-items: center;
        gap: 9px;
        font-size: 16px;

        @media screen and (max-width: 640px) {
          font-size: 14px;
          line-height: 17px;
        }
      }

      h1 {
        display: flex;
        justify-content: center;
        font-size: 50px;
        font-weight: 500;
      }

      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type=number] {
        -moz-appearance: textfield;
      }


      .repeticionesContainer {
        max-width: 371px;
        display: flex;
        flex-direction: column;
        width: 100%;
        margin-top: 32px;
        border-bottom: 1.44px solid #dedede;
        padding-bottom: 12px;

        @media screen and (max-width: 640px) {
          margin-top: 26px;
          max-width: unset;
        }
      }

      .repeticionesContainer>label {
        padding: 0;
        margin: 0;
      }

      .timeToInvest {
        color: #757575;
        font-family: 'Neptune', sans-serif;
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 17.6px;
        margin-bottom: 8px !important;

        @media screen and (max-width: 640px) {
          margin-bottom: 10px !important;
        }
      }

      .repeticionesInputWrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .repeticiones {
        border: none;
        font-size: 24px;
        margin: 0;
        width: 30px;

        @media screen and (max-width: 640px) {
          padding-bottom: unset;
        }
      }

      .termToInvest {
        color: #000;
        font-family: 'Neptune', sans-serif;
        font-size: 24px;
        font-weight: 400;
        line-height: 28.8px;
      }

      .monthsContainer {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: #CFCDCD;
        margin-left: 0.2rem;
      }

      .termDisclaimerWrapper {
        display: flex;
        gap: 4px;
      }

      .progressContainer {
        width: 100%;
      }

      /*********** Baseline, reset styles ***********/
      .progress {
        margin-top: 1rem;
        appearance: none;
        /* background: transparent; */
        cursor: pointer;
        /* width: 100%; */
        background: linear-gradient(to right, #000 0%, #000 0%, #DEDEDE 0%, #DEDEDE 100%);
        border-radius: 8px;
        height: 7px;
        width: 100%;
        outline: none;
        -webkit-appearance: none;
      }

      /* Removes default focus */
      .progress:focus {
        outline: none;
      }

      /******** Chrome, Safari, Opera and Edge Chromium styles ********/
      /* slider track */
      .progress::-webkit-slider-runnable-track {
        border-radius: 2rem;
        height: 2px;
      }

      /* slider thumb */
      .progress::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        margin-top: -7px;
        background-color: #fff;
        outline: 4px solid #fff;
        border: 2px solid #000;
        border-radius: 2rem;
        height: 1rem;
        width: 1rem;
      }

      /*********** Firefox styles ***********/
      /* slider track */
      .progress::-moz-range-track {
        background-color: #000000;
        border-radius: 2rem;
        height: 2px;
      }

      /* slider thumb */
      .progress::-moz-range-thumb {
        background-color: #000000;
        border: none;
        border-radius: 2rem;
        height: 1rem;
        width: 1rem;
      }

      .progress:focus::-moz-range-thumb {
        outline: 3px solid #000000;
        outline-offset: 0.125rem;
      }


      .slide {
        display: none;
      }

      /* Responsive */
      @media screen and (max-width: 960px) {
        .form {
          flex-direction: column;
        }

        .graphic {
          margin-left: 0;

        }

        .radioGroup {
          grid-template-columns: 50% 1fr;
        }
      }

      @media screen and (max-width: 500px) {
        .progressContainer {
          width: 100%;
          max-width: 390px;
        }
      }

      @media screen and (max-width: 640px) {
        .slide {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: .5rem;
          font-size: 14px;
          color: #BBBBBB;
        }
      }
    </style>
  </head>


  <div class="container">
    <div class="form">
      <form>
        <p class="headTitle">Simula tu rendimiento</p>

        <div class="line">
          <label class="amountTitle" for="x">Monto a invertir</label>
          <div class="amountContainer">
            <div>
              <span>$</span>
              <input id="x" name="monto" class="amount" value="10000" required
                oninput="validarNumero(this), calcular()" />
              <span class="currency">MXN</span>
            </div>

            <div class="amountButtonContainer">
              <button type="button" class="counterButton" onclick="decrementarMonto()"><img
                  src="substract.png" /></button>
              <button type="button" class="counterButton" onclick="incrementarMonto()"><img src="add.png" /></button>
            </div>
          </div>

          <p class="disclaimer">Hasta $10,000,000 MXN</p>
        </div>

        <div class="line">
          <label class="chooseInvestedTerm">Selecciona el plazo</label>
          <div class="radioGroup">
            <div class="radioGroupItem">
              <input type="radio" id="opcion1" name="opcionGroup" value="opcion1" onclick="actualizarValores(this)"
                checked />
              <label for="opcion1" class="custom-radio"><img src="done.svg" /></label>
              A la vista
            </div>
            <div class="radioGroupItem">
              <input type="radio" id="opcion2" name="opcionGroup" value="opcion2" onclick="actualizarValores(this)" />
              <label for="opcion2" class="custom-radio"><img src="done.svg" /></label>
              28 días
            </div>
            <div class="radioGroupItem">
              <input type="radio" id="opcion3" name="opcionGroup" value="opcion3" onclick="actualizarValores(this)" />
              <label for="opcion3" class="custom-radio"><img src="done.svg" /></label>
              91 días
            </div>
            <div class="radioGroupItem">
              <input type="radio" id="opcion4" name="opcionGroup" value="opcion4" onclick="actualizarValores(this)" />
              <label for="opcion4" class="custom-radio"><img src="done.svg" /></label>
              182 días
            </div>
            <div class="radioGroupItem">
              <input type="radio" id="opcion6" name="opcionGroup" value="opcion6" onclick="actualizarValores(this)" />
              <label for="opcion6" class="custom-radio"><img src="done.svg" /></label>
              364 días
            </div>
            <div class="radioGroupItem">
              <input type="radio" id="opcion5" name="opcionGroup" value="opcion5" onclick="actualizarValores(this)" />
              <label for="opcion5" class="custom-radio"><img src="done.svg" /></label>
              364 días (con intereses cada 28 días)
            </div>
          </div>
        </div>

        <div style="display: none;">
          <p>Tasa: <span id="y">11.1</span></p>
          <p>Duración: <span id="z">30</span></p>
        </div>

        <div class="repeticionesContainer">
          <label class="timeToInvest" id="title" for="repeticiones">Años a invertir</label>

          <div class="repeticionesInputWrapper">
            <div>
              <input type="number" id="repeticiones" onkeyup="validar(this.value, event)" min="1" max="12"
                pattern="[1-9]|1[0-2]" class="repeticiones" />
              <span class="termToInvest" id="termToInvest">meses</span>
            </div>

            <div class="amountButtonContainer">
              <button type="button" class="counterButton" onclick="decrementarRepeticiones()"><img
                  src="substract.png" /></button>
              <button type="button" class="counterButton" onclick="incrementarRepeticiones()"><img
                  src="add.png" /></button>
            </div>
          </div>

          <div style="display: none;" class="progressContainer">
            <input type="range" class="progress" id="months" min="1" max="12" step="1" onchange="calcular()" />
          </div>

          <div style="display: none;" class="monthsContainer">
            <span>1</span>
            <span>12</span>
          </div>
        </div>

        <div class="termDisclaimerWrapper">
          <p class="disclaimer">Hasta 12
          <p class="disclaimer" id="termDisclaimer">meses</p>
        </div>
        </p>
      </form>

      <span class="slide">Desliza para ver más <img src="arrowDropDown.png" alt="Arrow drop down" /></span>
    </div>

    <div class="graphic">
      <div class="mobileTitle">Simula tu rendimiento</div>
      <div class="totalBalance">
        <label class="futureBalance">Saldo a futuro <br>(capital y rendimiento)</label>
        <span class="resultado" id="resultado">$0</span>
      </div>

      <div class="totalRetenciones">
        <label class="retencionesLabel">Impuestos</label>
        <span class="retenciones" id="retenciones">$0</span>
      </div>

      <ul id="listaResultados" style="display: none;">
        Los resultados calculados se agregarán aquí como elementos de lista
      </ul>
      <div class="graphicContainer">
        <canvas id="myChart" width="417px" height="300px"></canvas>
      </div>
    </div>
  </div>






  <script src="https://refreshless.com/nouislider/dist/nouislider.js?v=1550"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script src="https://refreshless.com/nouislider/documentation/assets/wNumb.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.min.js"></script>


  <script>

    // UMA
    const UMA = 108.57;

    // Retención en porcentaje
    const retencion = 0.50;

    // Retención en decimal
    const retencionDecimal = retencion / 100;

    // Calculo del UMA
    const calculodelUMA = UMA * 12 * 30.4 * 5;

    function actualizarValores(radioButton) {
      var yElement = document.getElementById("y");
      var zElement = document.getElementById("z");

      switch (radioButton.value) {
        case "opcion1":
          yElement.textContent = "11.1";
          zElement.textContent = "30";
          break;
        case "opcion2":
          yElement.textContent = "11.5";
          zElement.textContent = "28";
          break;
        case "opcion3":
          yElement.textContent = "12";
          zElement.textContent = "91";
          break;
        case "opcion4":
          yElement.textContent = "12.50";
          zElement.textContent = "182";
          break;
        case "opcion5":
          yElement.textContent = "13";
          zElement.textContent = "364";
          break;
        case "opcion6":
          yElement.textContent = "13.50";
          zElement.textContent = "364";
          break;
        default:
          yElement.textContent = "11.1";
          zElement.textContent = "30";
      }

      calcular(radioButton.value); // Calcular automáticamente al cambiar la opción seleccionada
    }

    // Función para incrementar el valor del input en mil unidades
    function incrementarMonto() {
      var input = document.getElementById('x');
      var valorActual = parseInt(input.value.replace(/\D/g, ''));

      var nuevoValor = valorActual + 1000;
      if (nuevoValor <= 10000000) {
        input.value = nuevoValor;
      } else {
        input.value = 10000000;
      }

      calcular();
    }


    // Función para decrementar el valor del input en mil unidades
    function decrementarMonto() {
      var input = document.getElementById('x');
      var valorActual = parseInt(input.value.replace(/\D/g, ''));

      input.value = Math.max(valorActual - 1000, 0);
      calcular();
    }

    // Función para incrementar el valor de las repeticiones en una unidad
    function incrementarRepeticiones() {
      var input = document.getElementById('repeticiones');
      var valorActual = parseInt(input.value.replace(/\D/g, ''));

      if (input.value < 12) {
        input.value = (valorActual + 1);
      }

      calcular();
    }

    // Función para decremantar el valor de las repeticiones en una unidad
    function decrementarRepeticiones() {
      var input = document.getElementById('repeticiones');
      var valorActual = parseInt(input.value.replace(/\D/g, ''));

      if (input.value > 1) {
        input.value = (valorActual - 1);
      }

      calcular();
    }

    function validar(value, event) {
      if (parseInt(value) > 12 || value.length > 2) {
        event.preventDefault();
        const repeticiones = document.getElementById("repeticiones");
        repeticiones.value = 1;
        return;
      }
      return calcular();
    }

    document.addEventListener("DOMContentLoaded", function () {
      const repeticionesInput = document.getElementById("repeticiones");
      const monthsInput = document.getElementById("months");

      repeticionesInput.value = 2;
      monthsInput.value = 2;

      // Actualiza la barra de progreso
      const progress = document.querySelector('.progress');
      var value = Math.floor((monthsInput.value / 12) * 100) - 4;
      progress.style.background = `linear-gradient(to right, #000 0%, #000 ${value}%, #DEDEDE ${value}%, #DEDEDE 100%)`;
    });





    document.addEventListener("DOMContentLoaded", function () {
      var radioButtons = document.getElementsByName("opcionGroup");
      var radioButtonValue;
      for (var i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
          radioButtonValue = radioButtons[i].value;
          break;
        }
      }
      actualizarValores(document.querySelector('input[name="opcionGroup"]:checked'));
    });

    document.addEventListener("DOMContentLoaded", function () {
      const repeticionesInput = document.getElementById("repeticiones");
      repeticionesInput.value = 2;
      validar(2, null);
    });


    function calcular(radioButtonOption) {
      if (radioButtonOption === undefined) {
        var radioButtons = document.getElementsByName("opcionGroup");
        for (var i = 0; i < radioButtons.length; i++) {
          if (radioButtons[i].checked) {
            radioButtonOption = radioButtons[i].value;
          }
        }
      }

      var y = parseFloat(document.getElementById("y").textContent);
      var z = parseFloat(document.getElementById("z").textContent);


      var inputElement = document.getElementById("x");

      // Remove any non-numeric characters and parse the resulting value as an integer
      var number = parseInt(inputElement.value.replace(/\D/g, ''));

      // Check if the input is a valid number
      if (!isNaN(number)) {
        var formattedNumber = number.toLocaleString("es-US");

        // Update the input value with the formatted number
        inputElement.value = formattedNumber;
        x = number;
      }

      var resultado = "0";


      if (x && x >= 0 && !isNaN(x)) {
        var resultado = ((x * y) / 360) * z;
        // Redondear el resultado a dos decimales
        resultado = (resultado / 100).toFixed(100);

        document.getElementById("resultado").textContent = resultado;

        const amount = x;
        calcularResultado(radioButtonOption, amount); // Llamar a la función calcularResultado para calcular los resultados adicionales
      } else {
        document.getElementById("resultado").textContent = "$0";
      }
    }




    let inversiones = [];
    let retornos = [];



    function calcularResultado(radioButtonOption, amount) {
      const resultadoOriginal = parseFloat(
        document.getElementById("resultado").textContent
      );
      const repeticiones = parseInt(
        document.getElementById("repeticiones").value
      );
      const title = document.getElementById("title");
      const termToInvest = document.getElementById("termToInvest");
      const termDisclaimer = document.getElementById("termDisclaimer");
      const listaResultados = document.getElementById("listaResultados");
      const x = amount;

      let repeticionesMultiplicadas = 0;
      let trimestral = false;
      let semestre = false;
      let anual = false;

      switch (radioButtonOption) {
        case "opcion1":
          repeticionesMultiplicadas = repeticiones;
          title.innerHTML = "Meses a invertir";
          termToInvest.innerHTML = "meses";
          termDisclaimer.innerHTML = "meses";
          break;
        case "opcion2":
          repeticionesMultiplicadas = repeticiones;
          title.innerHTML = "Meses a invertir";
          termToInvest.innerHTML = "meses";
          termDisclaimer.innerHTML = "meses";
          break;
        case "opcion3":
          repeticionesMultiplicadas = repeticiones * 3;
          title.innerHTML = "Trimestres a invertir";
          termToInvest.innerHTML = "trimestres";
          termDisclaimer.innerHTML = "trimestres";
          trimestral = true;
          break;
        case "opcion4":
          repeticionesMultiplicadas = repeticiones * 6;
          title.innerHTML = "Semestres a invertir";
          termToInvest.innerHTML = "semestres";
          termDisclaimer.innerHTML = "semestres";
          semestre = true;
          break;
        case "opcion5":
          repeticionesMultiplicadas = repeticiones * 12;
          title.innerHTML = "Años a invertir";
          termToInvest.innerHTML = "años";
          termDisclaimer.innerHTML = "años";
          anual = true;
          break;
        case "opcion6":
          repeticionesMultiplicadas = repeticiones * 12;
          title.innerHTML = "Años a invertir";
          termToInvest.innerHTML = "años";
          termDisclaimer.innerHTML = "años";
          anual = true;
          break;
        default:
          // No debería llegar aquí
          break;
      }

      // Limpiamos cualquier contenido previo en la lista de resultados
      listaResultados.innerHTML = "";

      let resultadoFinal = 0;
      let inversiones = [];
      let retornos = [];
      let retenciones = [];
      let sumaRetenciones = 0;

      let tasaInteres = parseFloat(document.getElementById("y").textContent) / 100; // Convertir a decimal
      let plazo = parseInt(document.getElementById("z").textContent);
      let montoInversion = parseFloat(document.getElementById("x").value.replace(/\D/g, ''));

      for (let i = 0; i < repeticionesMultiplicadas; i++) {
        let rendimiento = montoInversion * (tasaInteres / 360 * plazo);
        let resultado = montoInversion + rendimiento;

        const inversion = resultado.toFixed(2);
        const rendimientoFormateado = rendimiento.toFixed(2);

        // Actualizar monto de inversión para el próximo cálculo
        montoInversion = resultado;

        // Agregar el resultado a la lista de retornos
        retornos.push(+rendimientoFormateado);
        inversiones.push(inversion);

        // Crear un nuevo elemento de lista y agregarlo a la lista de resultados
        const listItem = document.createElement("li");
        listItem.textContent = `Repeticion ${i + 1}: ${rendimientoFormateado}`;
        listaResultados.appendChild(listItem);

        // Incrementar el contador según el tipo de período (trimestral, semestral, anual)
        if (trimestral) {
          i += 2;
        }
        if (semestre) {
          i += 5;
        }
        if (anual) {
          i += 11;
        }
      }

      for (var i = 1; i <= repeticiones; i++) {
        var duracion = i; // Duración actual
        let rendimiento = montoInversion * (tasaInteres / 360 * plazo);
        let resultado = montoInversion + rendimiento;

        if (duracion === 1) {
          montoInversion = parseFloat(document.getElementById("x").value.replace(/\D/g, ''));
        } else {
          montoInversion = resultado;
        }

        // Calcular la retención para la duración actual
        var retencion = (parseFloat(montoInversion).toFixed(2) - calculodelUMA) * retencionDecimal / 360 * plazo;

        if (retencion < 0) {
          retencion = 0; // Asignar 0 si la retención es negativa
        }

        // Guardar la retención en el array
        retenciones.push(parseFloat(retencion).toFixed(2));

        // Sumar la retención actual a la suma total
        sumaRetenciones += retencion;
      }

      // Mostrar el resultado en el elemento con el id "retenciones"
      document.getElementById("retenciones").textContent = '$' + formatNumber(sumaRetenciones);

      const labelsQuantity = retornos.length;
      const labels = [];
      for (let i = 0; i < labelsQuantity; i++) {
        labels.push(String(i));
      }

      // Obtener el valor particular a sumar
      let montoAInvertir = parseFloat(document.getElementById("x").value.replace(/\D/g, ''));

      let inversionesActualizado = inversiones.slice();
      inversionesActualizado.unshift(montoAInvertir.toFixed(2));

      let inversionesActualizadoLength = inversionesActualizado.length;

      let labelsForChart = [];

      for (let i = 0; i <= inversionesActualizadoLength - 1; i++) {
        labelsForChart.push(i.toString());
      }

      let retornosForChart = retornos.slice();
      retornosForChart.unshift(0);

      let retencionesForChart = retenciones.slice();
      retencionesForChart.unshift("0.00");

      let retencionesAplicadas = [];

      let sumaAcumulativaRetenciones = 0;
      let sumaAcumulativaRetencionesArray = retencionesForChart.map((valor) => {
        sumaAcumulativaRetenciones += parseFloat(valor);
        return sumaAcumulativaRetenciones;
      });

      for (let i = 0; i < inversionesActualizadoLength; i++) {
        let inversionActualizada = parseFloat(inversionesActualizado[i]);
        let retencion = parseFloat(sumaAcumulativaRetencionesArray[i]) || 0;
        let nuevoValor = (inversionActualizada - retencion).toFixed(2);
        retencionesAplicadas.push(nuevoValor);
      }

      // Actualiza los datos en el gráfico
      dataQualitySmall.data.datasets[1].data = retencionesAplicadas;
      dataQualitySmall.data.datasets[0].data = retornosForChart;
      dataQualitySmall.data.labels = labelsForChart;

      // Actualiza el gráfico
      dataQualitySmall.update();

      // Sumamos el valor de X al resultado final
      resultadoFinal += x;

      // Obtener el último elemento del array 'inversiones' que contiene el monto final con los rendimientos sumados
      const resultadoFinalConRendimientos = parseFloat(inversiones[inversiones.length - 1]);

      const resultadoFinalConRetenciones = resultadoFinalConRendimientos - sumaRetenciones;

      // Mostrar el resultado final con los rendimientos sumados en el elemento 'resultado'
      document.getElementById("resultado").textContent = "$" + formatNumber(resultadoFinalConRetenciones);
    }


    var canvas = document.getElementById("myChart");
    var ctx = canvas.getContext('2d');
    var dataQualitySmall = new Chart(ctx, {
      type: "bar",
      data: {
        labels: [
          "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"
        ],
        datasets: [{
          label: "Rendimiento",
          yAxisID: 'y-axis-2', // Asigna este dataset al primer eje Y
          type: "line",
          data: inversiones,
          backgroundColor: "transparent",
          borderColor: "#8590F9",
          borderWidth: 4,
          lineTension: 0,
        }, {
          label: "Capital",
          yAxisID: 'y-axis-1', // Asigna este dataset al segundo eje Y
          type: "bar",
          data: retornos,
          backgroundColor: "#2437F5",
          borderColor: "#2437F5",
          borderWidth: 1,
        }],
      },
      options: {
        scales: {
          yAxes: [{
            id: 'y-axis-1',
            type: 'linear',
            position: 'left', // Coloca este eje a la izquierda
            ticks: {
              beginAtZero: true
            }
          }, {
            id: 'y-axis-2',
            type: 'linear',
            position: 'right', // Coloca este eje a la derecha
          }]
        },
        tooltips: {
          borderColor: "#DEDEDE",
          borderWidth: 1,
          backgroundColor: "#F8F8F8",
          bodyFontColor: "#000",
          titleFontColor: "#000",
          width: 20,
        },
      },
    });





























    // Actualiza los datos en el gráfico

    // Actualiza el gráfico
    dataQualitySmall.update();

    $(function () {
      let idOfSlider = "slider-single";
      let idOfSliderInput = "x";

      $("#" + idOfSlider).css("display", "none");
      $("<div></div>").insertAfter("#" + idOfSlider);

      var single = $("#" + idOfSlider).next()[0];
      noUiSlider.create(single, {
        start: [0],
        range: {
          min: 0,
          max: 5000000,
        },
        step: 100,
      });

      var valueSingleInput = $("#" + idOfSliderInput);

      single.noUiSlider.on("update", function (values) {
        valueSingleInput.val(values[0]);
      });

      valueSingleInput.on("change", function () {
        single.noUiSlider.set([parseFloat(valueSingleInput.val())]);
      });
    });

    $(function () {
      let idOfSlider = "slider-single-2";
      let idOfSliderInput = "repeticiones";

      $("#" + idOfSlider).css("display", "none");
      $("<div></div>").insertAfter("#" + idOfSlider);

      var single = $("#" + idOfSlider).next()[0];
      noUiSlider.create(single, {
        start: [0],
        range: {
          min: 0,
          max: 100,
        },
        step: 1,
        tooltips: [wNumb({ decimals: 0, prefix: "" })],
      });

      var valueSingleInput = $("#" + idOfSliderInput);

      single.noUiSlider.on("update", function (values) {
        valueSingleInput.val(values[0]);
      });

      valueSingleInput.on("change", function () {
        single.noUiSlider.set([parseFloat(valueSingleInput.val())]);
      });
    });

    function validarNumero(input) {
      input.value = input.value.replace(/\D/g, ''); // Remueve todos los caracteres que no sean dígitos

      // Verificar si el valor es mayor a 10,000,000
      if (parseInt(input.value) > 10000000) {
        // Si es mayor, establecer el valor máximo permitido
        input.value = "10000000";
      }

      // Si el valor del input está vacío, mostrar "0"
      if (input.value === '') {
        input.value = "0";
      }
    }

    function formatNumber(number) {
      // Convert the number to a string with 2 decimal places
      var numberString = number.toFixed(2);

      // Replace the dot with a comma for decimals
      numberString = numberString.replace('.', ',');

      // Split into integer and decimal parts
      var parts = numberString.split(',');
      var integerPart = parts[0];
      var decimalPart = parts[1];

      // Replace comma with dot for thousands
      integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');

      // Concatenate integer and decimal parts with the new format
      return integerPart + '.' + decimalPart;
    }


  </script>



  <script>
    const value = document.querySelector("#repeticiones");
    const input = document.querySelector("#months");
    value.value = input.value;
    input.addEventListener("input", (event) => {
      value.value = event.target.value;
    });
    value.addEventListener("input", (event) => {
      if (event.target.value > 12) {
        event.target.value = 1;
      }

      input.value = event.target.value;
      calcular();
    });

    const progress = document.querySelector('.progress');

    progress.addEventListener('input', function () {
      var value = Math.floor((this.value / 12) * 100) - 4;
      this.style.background = `linear-gradient(to right, #000 0%, #000 ${value}%, #DEDEDE ${value}%, #DEDEDE 100%)`
    });
  </script>

</body>

</html>